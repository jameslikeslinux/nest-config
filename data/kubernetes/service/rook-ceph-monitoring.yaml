---
.affinity: &affinity
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
          - key: role
            operator: In
            values:
              - storage

.tolerations: &tolerations
  - key: role
    operator: Exists
    effect: NoSchedule

values:
  prometheusOperator:
    affinity: *affinity
    tolerations: *tolerations
  prometheus:
    prometheusSpec:
      serviceMonitorSelector:
        matchLabels:
          team: rook # read ServiceMonitors created by rook-ceph-operator
      affinity: *affinity
      tolerations: *tolerations

      # Tune storage retention, thus memory, for small nodes
      additionalArgs:
        - name: 'storage.tsdb.retention.size'
          value: '1GB'
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: eagle
            accessModes: ['ReadWriteOnce']
            resources:
              requests:
                storage: 10Gi
