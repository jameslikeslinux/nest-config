---
resources:
  - apiVersion: v1
    kind: Secret
    metadata:
      name: "%{nest::bolt::helm_release}-registry-auths"
    data:
      .dockerconfigjson: "%{nest::bolt::registry_auths}"
    type: kubernetes.io/dockerconfigjson

values:
  extraVolumes:
  - name: bolt-config
    hostPath:
      path: '/etc/puppetlabs/bolt'
      type: Directory
  service:
    loadBalancerIP: '172.21.0.2'
  mariadb:
    auth:
      password: "%{lookup('nest::service::wordpress::database_passwords.portfolio')}"

patches:
  image:
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: "%{nest::bolt::helm_release}-wordpress"
    spec:
      template:
        spec:
          containers:
            - name: nest
              image: registry.gitlab.james.tl/nest/puppet:cortex-a53
              imagePullPolicy: Always
              volumeMounts:
              - mountPath: '/etc/puppetlabs/bolt'
                name: bolt-config
                readOnly: true
          imagePullSecrets:
            - name: "%{nest::bolt::helm_release}-registry-auths"
