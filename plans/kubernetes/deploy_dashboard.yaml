---
description: 'Deploy Kubernetes dashboard'

parameters:
  targets:
    type: TargetSpec
    description: 'Host on which to run kubectl'

steps:
  - description: 'Deploy metrics server'
    plan: 'nest::kubernetes::apply'
    parameters:
      manifest: 'https://gitlab.james.tl/nest/kubernetes/-/raw/main/metrics-server.yaml'
    targets: $targets

  - description: 'Deploy Kubernetes dashboard'
    plan: 'nest::kubernetes::apply'
    parameters:
      manifest: 'https://gitlab.james.tl/nest/kubernetes/-/raw/main/kubernetes-dashboard.yaml'
    targets: $targets

  - description: 'Deploy nginx ingress'
    plan: 'nest::kubernetes::apply'
    parameters:
      manifest: 'https://gitlab.james.tl/nest/kubernetes/-/raw/main/ingress-nginx.yaml'
    targets: $targets

  - description: 'Wait for nginx ingress deployment'
    plan: 'nest::kubernetes::wait'
    parameters:
      kind: daemonset
      name: 'ingress-nginx-controller'
      namespace: 'ingress-nginx'
    targets: $targets

  - description: 'Configure dashboard ingress'
    plan: 'nest::kubernetes::apply'
    parameters:
      manifest: 'https://gitlab.james.tl/nest/kubernetes/-/raw/main/dashboard-ingress.yaml'
    targets: $targets
